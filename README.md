# üîç Vector Search Microservice

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ —Ç–∞–±–ª–∏—Ü–∞–º PostgreSQL —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∏ LLM —Ä–µ—Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥–∞.

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞
python3 -m venv vector_search_env
source vector_search_env/bin/activate
pip install -r requirements.txt

# 2. –ó–∞–ø—É—Å–∫
uvicorn app.main:app --host 0.0.0.0 --port 8000

# 3. –¢–µ—Å—Ç
curl http://localhost:8000/health
```

**üìö –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** [–î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø.md](–î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø.md)
**‚ö° –ë—ã—Å—Ç—Ä–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:** [–ë–´–°–¢–†–´–ô_–°–¢–ê–†–¢.md](–ë–´–°–¢–†–´–ô_–°–¢–ê–†–¢.md)

---

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—è–º —Ç–∞–±–ª–∏—Ü (embedding-based)
- LLM-—Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å –æ—Ü–µ–Ω–∫–æ–π —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ (1-10)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç—Ä–µ—Ö –º–µ—Ç—Ä–∏–∫ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è: cosine, L2, dot_product
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Ollama –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (Qwen3)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Gemma3 (27B) –¥–ª—è –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ —Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥–∞
- Async API –Ω–∞ FastAPI

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:
```bash
source vector_search_env/bin/activate
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install -r requirements.txt
```

3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `.env` —Ñ–∞–π–ª (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)

## –ó–∞–ø—É—Å–∫

```bash
python -m app.main
```

–ò–ª–∏ —á–µ—Ä–µ–∑ uvicorn:
```bash
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

## API Endpoints

### 1. GET `/health`
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞

### 2. POST `/search`
–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Ç–∞–±–ª–∏—Ü

**Request:**
```json
{
  "query": "—Ç–∞–±–ª–∏—Ü—ã —Å–æ —à–∫–æ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏",
  "top_n": 10,
  "method": "cosine"
}
```

**Response:**
```json
{
  "results": [
    {
      "table_name": "school_table",
      "score": 0.9234
    }
  ],
  "total": 1
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `query` (str): –¢–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞
- `top_n` (int): –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (1-100, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10)
- `method` (str): –ú–µ—Ç–æ–¥ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è - "cosine", "L2", "dot_product"

### 3. POST `/search_rerank`
–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ + LLM-—Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥ –¥–ª—è —É–ª—É—á—à–µ–Ω–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏

**Request:**
```json
{
  "query": "—à–∫–æ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ",
  "prompt": "–ù—É–∂–Ω—ã —Ç–∞–±–ª–∏—Ü—ã —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —à–∫–æ–ª–∞—Ö, —É—á–µ–Ω–∏–∫–∞—Ö –∏ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —É—á—Ä–µ–∂–¥–µ–Ω–∏—è—Ö",
  "top_n": 50,
  "method": "cosine"
}
```

**Response:**
```json
{
  "results": [
    {
      "table_name": "edu_schools",
      "score": 10.0,
      "table_description": "This table contains information about schools..."
    },
    {
      "table_name": "edu_performance",
      "score": 8.0,
      "table_description": "This table stores performance metrics..."
    }
  ],
  "total": 2
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `query` (str): –¢–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
- `prompt` (str): –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è LLM (–æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —á—Ç–æ –∏–º–µ–Ω–Ω–æ –∏—â–µ–º)
- `top_n` (int): –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –¥–ª—è —Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 50)
- `method` (str): –ú–µ—Ç–æ–¥ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è - "cosine", "L2", "dot_product"

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –Ω–∞—Ö–æ–¥–∏—Ç top_n –ø–æ—Ö–æ–∂–∏—Ö —Ç–∞–±–ª–∏—Ü
2. LLM (Gemma3:27b) –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã –æ—Ç 1 –¥–æ 10
3. –í–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—Ü—ã —Å –æ—Ü–µ–Ω–∫–æ–π ‚â•5, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ score

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É:
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc
