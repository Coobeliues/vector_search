# ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç - Vector Search API

## üöÄ –ó–∞–ø—É—Å–∫ –∑–∞ 5 –º–∏–Ω—É—Ç

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

```bash
# –†–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å –∞—Ä—Ö–∏–≤ (–µ—Å–ª–∏ –ø–æ–ª—É—á–∏–ª–∏ tar.gz)
tar -xzf vector_search.tar.gz
cd Vector_search

# –ò–õ–ò –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
cd /path/to/Vector_search
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python3 -m venv vector_search_env

# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
source vector_search_env/bin/activate

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–∑–∞–π–º–µ—Ç 1-2 –º–∏–Ω—É—Ç—ã)
pip install -r requirements.txt
```

### 3. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
uvicorn app.main:app --host 0.0.0.0 --port 8000
```

**‚úÖ –ì–æ—Ç–æ–≤–æ!** –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ `http://localhost:8000`

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# –¢–µ—Å—Ç 1: Health check
curl http://localhost:8000/health

# –¢–µ—Å—Ç 2: –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫
curl -X POST "http://localhost:8000/search" \
  -H "Content-Type: application/json" \
  -d '{"query": "–ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏—è", "top_n": 3}'

# –¢–µ—Å—Ç 3: –õ—É—á—à–∏–π –º–µ—Ç–æ–¥ (—Å LLM)
curl -X POST "http://localhost:8000/search_rerank" \
  -H "Content-Type: application/json" \
  -d '{"query": "–°–∫–æ–ª—å–∫–æ –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–π –≤ 2020 –≥–æ–¥—É?", "top_n": 50}'
```

---

## üìö –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ó–∞–ø—É—Å–∫/–æ—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å
uvicorn app.main:app --host 0.0.0.0 --port 8000

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å auto-reload (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å: Ctrl+C
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –∫–∞—á–µ—Å—Ç–≤–∞ –ø–æ–∏—Å–∫–∞ (51 –≤–æ–ø—Ä–æ—Å)
python test_benchmark.py

# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
# –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://localhost:8000/docs
```

---

## üîå –ì–ª–∞–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–π–Ω—Ç—ã

### 1Ô∏è‚É£ `/search` - –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ (100ms)

```bash
curl -X POST "http://localhost:8000/search" \
  -H "Content-Type: application/json" \
  -d '{
    "query": "–≤–∞—à –∑–∞–ø—Ä–æ—Å",
    "top_n": 10,
    "method": "dot_product"
  }'
```

### 2Ô∏è‚É£ `/search_rerank` - –¢–æ—á–Ω—ã–π –ø–æ–∏—Å–∫ (2-5s) ‚≠ê –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø

```bash
curl -X POST "http://localhost:8000/search_rerank" \
  -H "Content-Type: application/json" \
  -d '{
    "query": "–≤–∞—à –∑–∞–ø—Ä–æ—Å",
    "top_n": 50,
    "method": "dot_product"
  }'
```

**–ü–æ—á–µ–º—É –ª—É—á—à–∏–π:**
- ‚úÖ TOP_1: 27.5% (–ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç LLM –¥–ª—è —É–º–Ω–æ–≥–æ —Ä–µ—Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥–∞
- ‚úÖ –ë–∞—Ç—á–∏–Ω–≥ –ø–æ 10 —Ç–∞–±–ª–∏—Ü (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
Vector_search/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ main.py              # üîå FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ search.py            # üîç –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫
‚îÇ   ‚îú‚îÄ‚îÄ rerank.py            # üß† LLM —Ä–µ—Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥
‚îÇ   ‚îú‚îÄ‚îÄ hybrid_search.py     # üîÄ –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (Vector+Tags)
‚îÇ   ‚îú‚îÄ‚îÄ hybrid_search_bm25.py# üîÄ –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (Vector+BM25)
‚îÇ   ‚îú‚îÄ‚îÄ embedding.py         # üìä –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ database.py          # üíæ PostgreSQL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ models.py            # üìù Pydantic –º–æ–¥–µ–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ config.py            # ‚öôÔ∏è  –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ .env                     # üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (–ø–∞—Ä–æ–ª–∏, —Ö–æ—Å—Ç—ã)
‚îú‚îÄ‚îÄ requirements.txt         # üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îú‚îÄ‚îÄ test_benchmark.py        # üß™ –¢–µ—Å—Ç—ã –∫–∞—á–µ—Å—Ç–≤–∞
‚îú‚îÄ‚îÄ benchmarks.json          # üìä –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (51 –≤–æ–ø—Ä–æ—Å)
‚îú‚îÄ‚îÄ –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø.md          # üìö –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ –ë–´–°–¢–†–´–ô_–°–¢–ê–†–¢.md        # ‚ö° –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (.env)

```env
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL
DB_HOST=your_database_host
DB_PORT=5432
DB_NAME=your_database_name
DB_USER=your_db_user
DB_PASSWORD=your_db_password

# Ollama —Å–µ—Ä–≤–µ—Ä
OLLAMA_HOST=http://your_ollama_host:11434
EMBEDDING_MODEL=dengcao/Qwen3-Embedding-0.6B:Q8_0
RERANK_MODEL=gemma3:27b

# API
API_HOST=0.0.0.0
API_PORT=8000
```

**‚ö†Ô∏è –ù–µ –º–µ–Ω—è–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏!**

---

## üÜò –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### ‚ùå "Database connection failed"

```bash
# –ü—Ä–æ–≤–µ—Ä—å –¥–æ—Å—Ç—É–ø –∫ –±–∞–∑–µ
psql -h your_database_host -U your_db_user -d your_database_name

# –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –ø—Ä–æ–≤–µ—Ä—å .env —Ñ–∞–π–ª
cat .env | grep DB_
```

### ‚ùå "Module not found: app"

```bash
# –ê–∫—Ç–∏–≤–∏—Ä—É–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ!
source vector_search_env/bin/activate

# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
```

### ‚ùå "Port 8000 already in use"

```bash
# –ò—Å–ø–æ–ª—å–∑—É–π –¥—Ä—É–≥–æ–π –ø–æ—Ä—Ç
uvicorn app.main:app --host 0.0.0.0 --port 8001
```

### ‚ùå –°–µ—Ä–≤–µ—Ä –º–µ–¥–ª–µ–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** LLM –º–æ–¥–µ–ª—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ Ollama –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:** –£–º–µ–Ω—å—à–∏ `top_n` –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 50)

---

## üìä Benchmark —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### `/search_rerank` (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```
–ü–∞—Ä–∞–º–µ—Ç—Ä—ã: top_n=100, method=dot_product
–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
  ‚úÖ TOP_1:   27.5% (14/51 —Ç–µ—Å—Ç–æ–≤)
  ‚úÖ TOP_3:   31.4% (16/51 —Ç–µ—Å—Ç–æ–≤)
  ‚ö†Ô∏è  TOP_5:   15.7% (8/51 —Ç–µ—Å—Ç–æ–≤)
  ‚ùå NOT_FOUND: 3.9% (2/51 —Ç–µ—Å—Ç–æ–≤)
–°—Ä–µ–¥–Ω—è—è –ø–æ–∑–∏—Ü–∏—è: 5.51
```

### `/search` (–±–∞–∑–æ–≤—ã–π)

```
–ë—ã—Å—Ç—Ä–æ, –Ω–æ –º–µ–Ω–µ–µ —Ç–æ—á–Ω–æ
–ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∏–ª–∏ –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
```

---

## üåê –î–æ—Å—Ç—É–ø –∏–∑ —Å–µ—Ç–∏

–ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –º–∞—à–∏–Ω–µ —Å IP `10.10.4.38`:

```bash
# –° –¥—Ä—É–≥–æ–π –º–∞—à–∏–Ω—ã –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏:
curl http://10.10.4.38:8000/health

# –ß–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä:
http://10.10.4.38:8000/docs
```

---

## üìû –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?

1. **–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `–î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø.md`
2. **API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** http://localhost:8000/docs (–∫–æ–≥–¥–∞ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω)
3. **–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:** `test_benchmark.py`, `test_hybrid_simple.py`

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –∫–æ–ª–ª–µ–≥–∏

- [ ] –†–∞—Å–ø–∞–∫–æ–≤–∞–ª –ø—Ä–æ–µ–∫—Ç
- [ ] –°–æ–∑–¥–∞–ª –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏–ª –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ requirements.txt
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª .env —Ñ–∞–π–ª
- [ ] –ó–∞–ø—É—Å—Ç–∏–ª —Å–µ—Ä–≤–µ—Ä
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª /health endpoint
- [ ] –í—ã–ø–æ–ª–Ω–∏–ª —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∫ /search
- [ ] –í—ã–ø–æ–ª–Ω–∏–ª —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∫ /search_rerank
- [ ] –ó–∞–ø—É—Å—Ç–∏–ª test_benchmark.py
- [ ] –ü—Ä–æ—á–∏—Ç–∞–ª –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø.md

**üéâ –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç? –ü–æ–∑–¥—Ä–∞–≤–ª—è—é!**

---

## üéØ –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ

**–ò—Å–ø–æ–ª—å–∑—É–π `/search_rerank` –¥–ª—è production!**

–≠—Ç–æ –ª—É—á—à–∏–π –º–µ—Ç–æ–¥ –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
